---
title: "通知設定"
---

TWSNMP FCが監視しているネットワークに問題を発見した時や毎日の状況をメールで通信する機能があります。通知を行うための設定についての説明です。

# 動画マニュアル

https://youtu.be/mRSJ6EyEVTA

# 通知設定の画面を表示する
メニューの「システム設定」ー「通知」をクリックしてください。

![](/images/books/twsnmpfc-manual/picture_pc_cb8da9fba9e87079afa178efd4463519.png)

# 通知設定画面

![](/images/books/twsnmpfc-manual/2022-12-22_06-17-14.png)

のような感じです。

## メールサーバー
メールを中継するSMTPサーバーのアドレスとポート番号を:（コロン）で区切って指定します。メールソフトで送信用のメールサーバーに設定しているものと同じでよいです。（例：192.168.1.201:25)

## サーバー証明書を検証しない
メールサーバーとの通知を暗号化(TLS)する場合、サーバーが提示した証明書を検証するかどうか設定の設定です。インターネット経由でパブリックなメールサーバーを利用する場合は、検証した方がよいです。ローカルな環境のメールサーバーを利用する場合は、検証すると通信できない場合があります。この場合はこのスイッチをオンに設定してください。

## ユーザーID/パスワード
メールを送信する時にメールサーバーの認証が必要な場合に、ユーザーIDを設定します。これもメールソフトで設定しているものと同じでよいです。認証が必要なければ、空欄でよいです。メールサーバーの認証をする時はパスワードも指定してください。

## 宛先メールアドレス
通知メールの送信先メールアドレスを指定します。多分、カンマ区切りで複数指定できるはずです。

## 送信元メールアドレス
通知メールの送信元メールアドレスを指定します。

## 件名
通知メールの件名の先頭につける文字列です。お好きなように設定してください。メールソフトで振分するのに利用できます。

## ノード名を含める
オンにすると通知メールの件名に関連するノードの名前を追加します。

## メール文面に含めるTWSNMP FCのURL
HTMLメールやチャットの通知の中に含める通知を送信したTWSNMP　FCへアクセスするためのURLを指定します。初期値はブラウザーからのアクセス先のURLを元に表示しています。

## HTML形式でメールを送信する
オンにすると障害通知、定期レポート、テストメールをHTML形式のメールで送信します。オフの場合は、テキストメールです。

## 送信間隔
メール通知の判断を行う間隔を分単位で設定します。後で説明します。

## レベル
イベントログに、この設定以上のレベルのログがあった場合にメール通知を行います。

## 復帰した時も通知する
ポーリングの状態が障害から復帰状態に変わった場合にも通知する設定です。

## 定期レポートを送信する
毎日夜中の０時にTWSNMP　FCで監視するネットワークに関するレポートをメールで送信します。

## 最新情報リスト
定期レポートに最近発見したデバイスなどのリストを含める場合にオンにします。v1.7.0から対応です。

## 信用スコア下位リストも送信
定期レポートに信用スコアが下位のリストを含める場合にオンにします。
デバイス、ユーザーID、IPのレポートの下位リストを送信します。

## 更新版を確認する
TWSNMP FCの最新版の有無をwww.twise.co.jpのサイトで確認します。更新版がある場合はイベントログに記録されます。

## チャット通知
チャットによる通知を行う場合に設定します。v1.7.0ではDiscordに対応しています。Discordを選択すると

![](/images/books/twsnmpfc-manual/1641182183343-r3GI7621fh.png)

のような画面になります。

## チャットWebhookのURL
Discordの設定でWebhookを作ってURLをコピーしてください。

![](/images/books/twsnmpfc-manual/1641182406506-HJWOBWutXh.png)

## コマンド実行
データストアのフォルダにcmdというフォルダを作って実行したいスクリプトなどを配置します。そのコマンドをこの欄に設定すれば、以下の動作をします。

- １分毎にマップ上のノード状態を確認して最悪の状態をマップの状態をチェックします。
- マップの状態が変化したら通知コマンドを$levelを状態値の数値にして実行する
- $levelの数値は、重度：０、軽度：１、注意：２，その他：３です。

## ＜テスト＞ボタン
メール通知の設定内容を確認するために試験メールを送信します。

## <CHATテスト＞ボタン
チャット通知のテストを行います。

## ＜コマンドテスト＞ボタン
コマンド実行の設定をテスト実行します。

# 通知メールをいつ送るか？
オリジナルのTWSNMPでは一つのポーリングで異常を検知したらすぐにメール通知するような方法でした。これだとやたら通知メールを受信するのでうんざりすることになります。長年の経験をもとに復刻版TWSNMPとTWSNMP FCでは、

![](/images/books/twsnmpfc-manual/picture_pc_b665b143e1a7f3109e14f940720ded89.png)

のような方法でメール通知を行うようにしました。これなら、１時間に１回重度以上の問題を見つけた時だけメール通知するというような設定ができます。心配性な人のために５分に一回、注意以上の問題がある時に通知するという設定もできます。１秒も待てない、もっと心配性な人のための設定は残念ながらできません。そんなに急いでも大きな差はありません。

チャットの通知はリアルタイムです。


# 個人用のメールサーバー
TWSNMPのメール通知は、ローカルなサーバーで十分です。ローカルなメールサーバーは、Linuxを使えば簡単に作れます。
Raspberry Piや古いPCを利用すればよいと思います。


